import re

default_roots = {
    # Functional words and prepositions
    'кажд': ('every',
             ['ый', 'ые', 'ого', 'ым', 'ых', 'ому', 'ую', 'ом', 'ыми',
              'их', 'ое', 'ая']),
    'через': ('through', ['']),
    'до': ('until', ['']),
    'по': ('through', ['']),
    'на': ('on', ['']),
    'в': ('at', ['']),
    'во': ('on', []),
    'с': ('from', ['']),
    'со': ('from', ['']),
    'от': ('from', ['']),
    'из': ('of', ['']),
    'и': ('and', ['']),
    'или': ('or', ['']),
    'оба': ('both', ['']),
    'обе': ('both', ['']),
    'раз': ('times', ['', 'а', 'у', 'ом', 'ами', 'ах']),
    'дважды': ('twice', ['']),
    'трижды': ('three times', ['']),
    'числ': ('day', ['о', 'а', 'у', 'е', 'ом', 'ам', 'ах']),
    'кроме': ('except', ['']),
    'течен': ('during', ['ие', 'ии', 'ия']),
    'эт': ('this', ['о', 'и', 'их', 'ими']),

    # ordinal endings
    'е': ('th', []),
    'ый': ('st', []),
    'ой': ('nd', []),
    'ий': ('rd', []),
    'й': ('th', []),
    'ю': ('th', []),
    'ая': ('th', []),
    'я': ('th', []),
    'ое': ('th', []),
    'ые': ('th', []),
    'ого': ('th', []),
    'ому': ('th', []),
    'ым': ('th', []),
    'им': ('th', []),
    'ом': ('th', []),
    'ем': ('th', []),
    'ую': ('th', []),
    'их': ('th', []),
    'ья': ('rd', []),
    'ье': ('rd', []),
    'ьи': ('rd', []),
    'ьего': ('rd', []),
    'ьему': ('rd', []),
    'ьим': ('rd', []),
    'ьем': ('rd', []),
    'ью': ('rd', []),
    'ьих': ('rd', []),
    'го': ('th', []),

    # Relative days
    'вчера': (
        'yesterday', ['', 'шний', 'шнего', 'шнему', 'шним', 'шнем']),
    'сегодня': (
        'today', ['', 'шний', 'шнего', 'шнему', 'шним', 'шнем']),
    'завтра': (
        'tomorrow', ['', 'шний', 'шнего', 'шнему', 'шним', 'шнем']),
    'послезавтра': ('day-after-tomorrow',
                    ['', 'шний', 'шнего', 'шнему', 'шним', 'шнем']),
    'позавчера': ('day-before-yesterday',
                  ['', 'шний', 'шнего', 'шнему', 'шним', 'шнем']),

    # Actions and events
    'повтор': ('repeat', ['ять', 'яешь', 'яют', 'яя', 'яю']),
    'начин': ('start', ['аться', 'ается', 'аются', 'ая', 'аю']),
    'заканч': (
        'end', ['аться', 'ается', 'аются', 'ая', 'аю', 'ивается']),
    'следующ': ('next',
                ['ий', 'ая', 'ее', 'ие', 'его', 'ему', 'им', 'ем', 'их',
                 'ую']),

    'последн': ('last',
                ['ий', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                 'ими', 'их', 'ую', 'ею', 'юю', 'яя', 'ее']),
    'предпоследн': ('second-to-last',
                    ['ий', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                     'ими', 'их', 'ую', 'ею', 'юю', 'яя', 'ее']),
    'конц': ('end', ['а', 'у', 'ом', 'е', 'ами', 'ам', 'ах']),
    'середин': (
        'middle', ['а', 'ы', 'е', 'у', 'ой', 'ам', 'ами', 'ах']),

    # Time units
    'утр': ('am', ['о', 'а', 'ом', 'е']),
    'дней': ('days', []),
    'дни': ('days', []),
    'днях': ('days', []),
    'дня': ('days', []),
    'дн': ('day', ['ем', 'е']),
    'ден': ('day', ['ь']),
    'вечер': ('pm', ['', 'а', 'у', 'ом', 'е', 'и', 'ов']),
    'полден': ('noon', ['ь', 'я', 'ем', 'е']),
    'ноч': ('am', ['ь', 'и', 'ью', 'ей', 'ам', 'ами', 'ах']),
    'час': ('hour', ['', 'а', 'у', 'ом', 'е', 'ы', 'ов']),
    'полчас': ('half hour', ['', 'а']),
    'минут': ('minutes', ['а', 'ы', 'ми', 'ах', 'ами', 'у']),
    'секунд': ('seconds', ['а', 'ы', 'ми', 'ах', 'ами', 'у']),

    # Periods
    'полгод': ('half-year', ['а', 'у', 'ом', 'ами']),
    'полугоди': ('half-year', ['е', 'я', 'ю', 'ем', 'и']),
    'ежегодн': (
        'yearly', ['о', 'ая', 'ое', 'ые', 'ому', 'ыми', 'ом', 'ого', 'ых']),
    'квартал': ('quarter', ['', 'а', 'у', 'ом', 'е', 'ы', 'ами', 'ах']),
    'год': ('year', ['', 'а', 'у', 'ом', 'е']),
    'лет': ('years', ['']),
    'месяц': ('month', ['', 'а', 'у', 'ем', 'е', 'ев']),
    'ежемесячн': ('monthly', ['о', 'ая', 'ое', 'ые', 'ому', 'ыми',
                              'ом', 'ого', 'ых']),
    'недел': ('week', ['ь', 'я', 'ю', 'е', 'ей', 'ями', 'ях', 'и']),
    'еженедельн': (
        'weekly',
        ['о', 'ая', 'ое', 'ые', 'ому', 'ыми', 'ом', 'ого', 'ых']),
    'ежедневн': (
        'daily',
        ['о', 'ая', 'ое', 'ые', 'ому', 'ыми', 'ом', 'ого', 'ых']),
    'полдн': ('noon', ['я', 'ю', 'ем', 'е', 'ями', 'ях']),

    # Days of week
    'понедельник': (
        'monday', ['', 'а', 'у', 'ом', 'е', 'и', 'ов', 'ам']),
    'вторник': ('tuesday', ['', 'а', 'у', 'ом', 'е', 'и', 'ов', 'ам']),
    'сред': ('wednesday', ['а', 'у', 'е', 'ы', 'ам']),
    'четверг': ('thursday', ['', 'а', 'у', 'ом', 'е', 'и', 'ов', 'ам']),
    'пятниц': ('friday', ['а', 'у', 'е', 'ы', 'ам']),
    'суббот': ('saturday', ['а', 'у', 'е', 'ы', 'ам']),
    'воскресень': ('sunday', ['е', 'я', 'ю', 'ем', 'е', 'ям']),

    # Week boundaries
    'рабоч': ('workday', ['ий', 'ие', 'его', 'ему', 'им', 'ем', 'их']),
    'выходн': ('weekend', ['ой', 'ые', 'ого', 'ому', 'ым', 'ом', 'ых']),
    'будн': ('weekdays', ['ие', 'ий', 'ям']),

    # Sequence markers
    'начал': ('start', ['о', 'а', 'у', 'ом', 'е']),
    'старт': (
        'start', ['', 'а', 'у', 'е', 'ом', 'е', 'ы', 'ами', 'ах']),
    'конец': ('end', ['', 'а', 'у', 'ом', 'е']),

    # Ordinal numbers 1–31
    'перв': ('first',
             ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
              'их', 'ую', 'ий', 'ой']),
    'втор': ('second',
             ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
              'их', 'ую', 'ий', 'ой']),
    'трет': ('third',
             ['ий', 'ья', 'ье', 'ьему', 'ым', 'ом', 'ими',
              'их', 'ую', 'ий', 'ой', 'ьего']),
    'трех': ('three', []),
    'трёх': ('three', []),
    'четверт': ('fourth',
                ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                 'ыми', 'их', 'ую', 'ий', 'ой']),
    'пят': ('fifth',
            ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
             'их', 'ую', 'ий', 'ой']),
    'шест': ('sixth',
             ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
              'их', 'ую', 'ий', 'ой']),
    'седьм': ('seventh',
              ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
               'их', 'ую', 'ий', 'ой']),
    'восьм': ('eighth',
              ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
               'их', 'ую', 'ий', 'ой']),
    'девят': ('ninth',
              ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
               'их', 'ую', 'ий', 'ой']),
    'десят': ('tenth',
              ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом', 'ыми',
               'их', 'ую', 'ий', 'ой']),
    'одиннадцат': ('eleventh',
                   ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                    'ыми', 'их', 'ую', 'ий', 'ой']),
    'двенадцат': ('twelfth',
                  ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                   'ыми', 'их', 'ую', 'ий', 'ой']),
    'тринадцат': ('thirteenth',
                  ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                   'ыми', 'их', 'ую', 'ий', 'ой']),
    'четырнадцат': ('fourteenth',
                    ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                     'ыми', 'их', 'ую', 'ий', 'ой']),
    'пятнадцат': ('fifteenth',
                  ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                   'ыми', 'их', 'ую', 'ий', 'ой']),
    'шестнадцат': ('sixteenth',
                   ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                    'ыми', 'их', 'ую', 'ий', 'ой']),
    'семнадцат': ('seventeenth',
                  ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                   'ыми', 'их', 'ую', 'ий', 'ой']),
    'восемнадцат': ('eighteenth',
                    ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                     'ыми', 'их', 'ую', 'ий', 'ой']),
    'девятнадцат': ('nineteenth',
                    ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                     'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцат': ('twentieth',
                ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                 'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьперв': ('twenty-first',
                     ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                      'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьвтор': ('twenty-second',
                     ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                      'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьтрет': ('twenty-third',
                     ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                      'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьчетверт': ('twenty-fourth',
                        ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым',
                         'ом', 'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьпят': ('twenty-fifth',
                    ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                     'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьшест': ('twenty-sixth',
                     ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                      'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьседьм': ('twenty-seventh',
                      ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                       'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьвосьм': ('twenty-eighth',
                      ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                       'ыми', 'их', 'ую', 'ий', 'ой']),
    'двадцатьдевят': ('twenty-ninth',
                      ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                       'ыми', 'их', 'ую', 'ий', 'ой']),
    'тридцат': ('thirtieth',
                ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                 'ыми', 'их', 'ую', 'ий', 'ой']),
    'тридцатьперв': ('thirty-first',
                     ['ый', 'ая', 'ое', 'ые', 'ого', 'ому', 'ым', 'ом',
                      'ыми', 'их', 'ую', 'ий', 'ой']),
    # Кардинальные числа
    'од': ('one', ['ин', 'ного', 'ному', 'ним', 'ном']),
    'дв': ('two', ['а', 'ух', 'ум', 'а', 'умя', 'ух', 'е']),
    'три': ('three', ['', 'ех', 'ем', '', 'емя', 'ех']),
    'четыр': ('four', ['е', 'ех', 'ем', 'е', 'емя', 'ех']),
    'пят': ('five', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'шест': ('six', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'сем': ('seven', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'восем': ('eight', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'девят': ('nine', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'десят': ('ten', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'одиннадцат': ('eleven', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'двенадцат': ('twelve', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'тринадцат': ('thirteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'четырнадцат': ('fourteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'пятнадцат': ('fifteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'шестнадцат': ('sixteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'семнадцат': ('seventeen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'восемнадцат': ('eighteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    'девятнадцат': ('nineteen', ['ь', 'и', 'и', 'ь', 'ью', 'и']),
    # Десятки
    'двадцат': ('twenty', ['', 'ух', 'ум', '', 'умя', 'ух']),
    'тридцат': ('thirty', ['', 'ух', 'ум', '', 'умя', 'ух']),
    # Months
    'январ': ('january', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'феврал': ('february', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'март': ('march', ['', 'а', 'у', 'ем', 'е', 'ами', 'ах', 'ом']),
    'апрел': ('april', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'ма': ('may', ['й', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'июн': ('june', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'июл': ('july', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'август': ('august', ['', 'а', 'у', 'ом', 'е', 'ами', 'ах']),
    'сентябр': ('september', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'октябр': ('october', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'ноябр': ('november', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
    'декабр': ('december', ['ь', 'я', 'ю', 'ем', 'е', 'ями', 'ях']),
}


class WordByWordTranslator:
    """
    Translate Russian text to English word-by-word using regex-based inflection handling.
    Each entry in translation_roots must include a list of endings for that stem.
    Supports words with 'ё' by normalizing to 'е' internally, but preserves original if not translated.
    """

    def __init__(self, translation_roots=None):
        # Define default stems with per-stem endings
        # Each value: (English translation, [list of Russian endings])
        # Allow custom roots
        self.translation_roots = translation_roots.copy() if translation_roots else default_roots
        # Compile regex patterns for matching stems+endings
        self.word_patterns = []
        for stem, (eng, endings) in self.translation_roots.items():
            grp = '|'.join(re.escape(e) for e in endings if e)
            pattern = re.compile(rf"^{stem}(?:{grp})?$", flags=re.IGNORECASE)
            self.word_patterns.append((pattern, eng))

    def translate_word(self, word: str) -> str:
        original = word
        key = original.lower()
        norm_key = key.replace('ё', 'е')
        # Digits unchanged
        if norm_key.isdigit():
            return original
        # Non-word tokens unchanged
        if not re.match(r"^[\w-]+$", norm_key, flags=re.UNICODE):
            return original
        # Match patterns
        for pattern, eng in self.word_patterns:
            if pattern.match(norm_key):
                return eng
        return original

    def translate_text(self, text: str) -> str:
        parts = re.split(r'(\W+)', text, flags=re.UNICODE)
        return ''.join(
            self.translate_word(p) if re.match(r"^[\w-]+$", p,
                                               flags=re.UNICODE) else p
            for p in parts
        )


def main():
    translator = WordByWordTranslator()
    examples = [
        # Basic schedules
        "каждый понедельник в 9:00",
        "каждый вторник в 10:30",
        "каждый среду в 14:15",
        "каждый четверг в 18:45",
        "каждую пятницу в 12:00",
        "каждую субботу в 07:20",
        "каждое воскресенье в 21:10",
        "каждый рабочий день в 08:00",
        "каждые выходные в 10:00",
        "каждые полчаса",
        # Date ranges
        "с 1 января по 31 декабря",
        "с 5 февраля по 10 марта",
        "с 15 марта по 20 апреля",
        "с 20 апреля по 25 мая",
        "с 1 июня по 15 июля",
        # Frequency
        "раз в неделю",
        "дважды в месяц",
        "три раза в год",
        "раз в день",
        "раза в час",
        # Ordinals
        "первый понедельник месяца",
        "второй вторник месяца",
        "третий среда месяца",
        "последний четверг месяца",
        # Events
        "событие начинается 1 мая",
        "событие заканчивается 30 июня",
        "повторять событие каждые две недели",
        # Years
        "с 2020 года",
        "до 2025 года",
        "каждый год 31 декабря",
        "каждый год 1 января",
        # Mixed sentences
        "каждый понедельник и четверг в 9 часов утра",
        "каждый вторник и пятницу в 17:00",
        "каждые выходные и будние дни",
        "каждый рабочий и выходной день",
        # Months in cases
        "январь",
        "января",
        "январю",
        "январем",
        "январями",
        "январях",
        # Other months
        "февраль", "февраля", "февралю", "февралем", "февралями", "февралях",
        "март", "марта", "марту", "мартом", "мартами", "мартах",
        "апрель", "апреля", "апрелю", "апрелем", "апрелями", "апрелях",
        # Numbers
        "1 числа",
        "15 числа",
        "31 числа",
        # Times of day
        "утро", "утра", "утром",
        "день", "дня", "днем",
        "вечер", "вечера",
        "полдень", "полдня",
        # Complex
        "каждый первый понедельник и третий четверг",
        "каждый второй и четвёртый вторник",
        "повторять с 1 марта до 31 марта каждую среду",
        "каждый рабочий час",
        "каждые два часа",
        "каждые три дня",
        "каждые пять минут",
        "повторять раз в год",
        # Additional
        "конец месяца",
        "конец года",
        "начало месяца",
        "начало года",
        "до конца недели",
        "с начала дня",
        "в середине месяца",
        "в середине недели",
        "каждый месяц",
        "каждые два месяца",
        "каждые три месяца",
        "каждый квартал",
        "каждый полугодие",
        "раз в полгода",
        "каждый час",
        "каждые пять часов",
        "раз в минуту",
        "каждую минуту",
        "каждые десять секунд",
        "раз в секунду",
        "каждую секунду",
        "с 1 января 2025 года",
        "по 31 декабря 2025 года",
        "с 1 мая до 1 июня",
        "каждый понедельник 1-го числа",
        "каждый последний день месяца",
        "каждый первый час дня",
        "каждый полдень",
        "каждые полдни",
        "каждые будние дни"
    ]
    for n, ex in enumerate(examples):
        print(f"{n}. {ex} -> {translator.translate_text(ex)}")


def is_ru(text):
    return bool(re.search(r"[А-Яа-яЁё]", text))


if __name__ == '__main__':  # pragma nocover
    main()
